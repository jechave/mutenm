---
title: "mutenm package"
author: "Julian Echave"
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  message = FALSE,
  warning = FALSE
)
```

# mutenm

The `mutenm` package builds Elastic Network Models (ENMs) of proteins and simulates mutation effects using linear response theory.

## Installation

```r
# install.packages("devtools")
devtools::install_github("jechave/mutenm")
```

## Overview

### What is an ENM?

An Elastic Network Model represents a protein as a network of nodes (typically Cα atoms) connected by harmonic springs. The model captures the protein's intrinsic flexibility through normal mode analysis.

### How are mutations simulated?

Mutations are modeled as perturbations to the equilibrium lengths of springs connected to the mutated site. The structural response is calculated using linear response theory:

```
δr = C × f
```

where `C` is the covariance matrix and `f` is the force from edge perturbations.

## Functions

| Function | Description |
|----------|-------------|
| `enm()` | Build an ENM from a PDB structure |
| `mutenm()` | Simulate a mutation at a specific site |
| `mrs()` | Mutation Response Scanning — scan all sites |
| `plot_mrs()` | Visualize MRS results |

## Quick Start

```{r}
library(mutenm)
```

### 1. Build an ENM

```{r}
pdb <- bio3d::read.pdb(system.file("extdata", "2acy.pdb", package = "mutenm"))
wt <- enm(pdb, node = "ca", model = "anm", d_max = 10.5)
```

### 2. Simulate a single mutation

```{r}
mut <- mutenm(wt, site_mut = 50, mutation = 1, mut_model = "lfenm", seed = 123)

# Calculate displacement
dxyz <- mut$nodes$xyz - wt$nodes$xyz
dr2 <- rowSums(matrix(dxyz^2, ncol = 3, byrow = TRUE))
```

### 3. Mutation Response Scanning

Scan all sites systematically:

```{r}
result <- mrs(pdb, pdb_id = "2ACY", nmut = 1, seed = 42)
names(result)
```

### 4. Visualize results

```{r plot-mrs, fig.width=8, fig.height=5}
plot_mrs(result)
```

Save as PDF for publications:

```{r eval=FALSE}
p <- plot_mrs(result)
ggplot2::ggsave("mrs_figure.pdf", p, width = 8, height = 5)
```

## Learn More

See the package vignette for a detailed introduction:

```r
vignette("introduction", package = "mutenm")
```
